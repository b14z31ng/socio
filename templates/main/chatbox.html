{% extends 'main/base.html' %}
{% block title %}Chat with {{ other_user.username }} | My Secure Social{% endblock %}
{% block content %}
<div style="display: flex; max-width: 900px; margin: 0 auto; min-height: 500px;">
    <div style="width: 260px; background: #f5f7fa; border-radius: 10px 0 0 10px; box-shadow: 0 2px 8px rgba(25,118,210,0.06); padding: 18px 0;">
        <h3 style="text-align:center; color:#1976d2;">Chats</h3>
        <ul style="list-style:none; padding:0; margin:0;">
            {% for u in users %}
            <li style="margin-bottom: 8px;">
                <a href="/chat/{{ u.id }}/" style="display:flex; align-items:center; padding:10px 18px; color:#263238; text-decoration:none; border-radius:6px; transition:background 0.2s;{% if u.id == other_user.id %} background:#e3f2fd;{% endif %}">
                    {% if u.profile.get_profile_pic_url %}
                        <img src="{{ u.profile.get_profile_pic_url }}" style="width:32px; height:32px; object-fit:cover; border-radius:50%; margin-right:10px;" />
                    {% else %}
                        <span class="profile-icon" style="font-size: 28px; color: #1976d2; margin-right: 10px;">&#128100;</span>
                    {% endif %}
                    <span>{{ u.username }}</span>
                </a>
            </li>
            {% empty %}
            <li style="text-align:center; color:#b0bec5;">No conversations yet.</li>
            {% endfor %}
        </ul>
    </div>
    <div style="flex:1; background:#fff; border-radius:0 10px 10px 0; box-shadow: 0 2px 8px rgba(25,118,210,0.06); display:flex; flex-direction:column;">
        <div style="padding: 18px 24px; border-bottom: 1px solid #e3f2fd; display:flex; align-items:center;">
            {% if other_user.profile.get_profile_pic_url %}
                <img src="{{ other_user.profile.get_profile_pic_url }}" style="width:36px; height:36px; object-fit:cover; border-radius:50%; margin-right:12px;" />
            {% else %}
                <span class="profile-icon" style="font-size: 32px; color: #1976d2; margin-right: 12px;">&#128100;</span>
            {% endif %}
            <span style="font-size:1.2em; color:#1976d2; font-weight:500;">{{ other_user.username }}</span>
        </div>
        <div style="flex:1; overflow-y:auto; padding: 24px; display:flex; flex-direction:column;">
            {% for msg in messages %}
                {% if msg.sender == request.user %}
                    <div style="align-self: flex-end; background: #1976d2; color: #fff; padding: 10px 18px; border-radius: 16px 16px 2px 16px; margin-bottom: 10px; max-width: 60%;">
                        {{ msg.get_content }}
                        <div style="font-size:0.8em; color:#bbdefb; text-align:right; margin-top:2px;">{{ msg.timestamp|date:'H:i' }}</div>
                    </div>
                {% else %}
                    <div style="align-self: flex-start; background: #e3f2fd; color: #263238; padding: 10px 18px; border-radius: 16px 16px 16px 2px; margin-bottom: 10px; max-width: 60%;">
                        {{ msg.get_content }}
                        <div style="font-size:0.8em; color:#90caf9; text-align:left; margin-top:2px;">{{ msg.timestamp|date:'H:i' }}</div>
                    </div>
                {% endif %}
            {% empty %}
                <div style="color:#b0bec5; text-align:center;">No messages yet. Say hi!</div>
            {% endfor %}
        </div>
        <form method="post" style="padding: 18px 24px; border-top: 1px solid #e3f2fd; display:flex; align-items:center;">
            {% csrf_token %}
            <input type="text" name="content" placeholder="Type a message..." style="flex:1; padding:10px; border-radius:8px; border:1px solid #cfd8dc; font-size:1em; margin-right:10px;">
            <button type="submit" style="padding:10px 18px;"><i class="fa-solid fa-paper-plane"></i></button>
        </form>
    </div>
</div>
{% endblock %}